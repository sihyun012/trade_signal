# Trade Signal 요구사항 명세서 (Requirements Specification)

**문서 버전**: 1.0  
**작성일**: 2026-01-28  
**프로젝트**: Trade Signal - 미국 의원 주식 거래 추적 시스템  
**상태**: 구현 완료 (ver1)

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [기능 요구사항](#3-기능-요구사항)
4. [데이터 요구사항](#4-데이터-요구사항)
5. [비기능 요구사항](#5-비기능-요구사항)
6. [인터페이스 요구사항](#6-인터페이스-요구사항)
7. [제약사항 및 가정](#7-제약사항-및-가정)

---

## 1. 프로젝트 개요

### 1.1 목적

Trade Signal은 미국 의원들의 주식 거래 내역을 추적하고 분석하는 웹 애플리케이션입니다. STOCK Act에 따라 공개된 의원 거래 데이터를 기반으로 포트폴리오 성과를 계산하고, S&P 500 지수와 비교하여 시각화합니다.

### 1.2 핵심 가치

- **투명성**: 공개된 거래 데이터 기반 객관적 성과 분석
- **비교 가능성**: S&P 500 대비 초과 수익률 제공
- **신뢰성**: 검증 가능한 계산 방법론 공개
- **접근성**: 직관적인 UI/UX로 복잡한 데이터 시각화

### 1.3 대상 사용자

| 사용자 유형 | 설명 | 주요 니즈 |
|-----------|------|----------|
| Primary | 투자자, 리서처, 기자, 정책 감시 사용자 | 빠른 성과 판단, 신뢰 가능한 근거, 비교 기준 |
| Secondary | 데이터 기반 콘텐츠 소비자 | 시각화된 데이터, 요약 정보 |

---

## 2. 시스템 아키텍처

### 2.1 기술 스택

#### 프론트엔드
- **언어**: HTML5, CSS3, JavaScript (Vanilla)
- **차트 라이브러리**: Canvas API
- **스토리지**: LocalStorage
- **폰트**: Inter (Google Fonts)
- **아이콘**: Font Awesome 6.4.0

#### 데이터 처리
- **언어**: Python 3.x
- **라이브러리**: pandas, yfinance, matplotlib
- **데이터 형식**: CSV, JSON

### 2.2 시스템 구조

```
┌─────────────────┐
│   사용자 브라우저    │
│  (Frontend)     │
│  - HTML/CSS/JS  │
│  - LocalStorage │
└────────┬────────┘
         │
         │ HTTP 요청
         │
┌────────▼────────┐
│  정적 파일 서버     │
│  - CSV 파일      │
│  - JSON 파일     │
│  - 이미지/리소스   │
└─────────────────┘
         │
         │ (별도 프로세스)
         │
┌────────▼────────┐
│  Python 스크립트    │
│  - 데이터 수집      │
│  - 분석/시각화     │
└─────────────────┘
```

### 2.3 데이터 흐름

```
CSV 파일 (의원 거래 데이터)
    ↓
JavaScript 파싱 (data.js)
    ↓
거래 데이터 정제 및 변환
    ↓
수익률 계산 (Net Worth 방법)
    ↓
S&P 500 데이터 로드/생성
    ↓
비교 분석 및 시각화
    ↓
UI 렌더링 (Canvas 차트)
```

---

## 3. 기능 요구사항

### 3.1 인증 및 사용자 관리

#### FR-AUTH-01: 로그인 페이지 진입 로직

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-01 |
| **기능명** | 로그인 페이지 진입 로직 |
| **우선순위** | P0 |
| **설명** | 진입 시 JWT/세션 체크 후 미인증 시 로그인 화면 강제 노출 |
| **전제조건** | 사용자가 애플리케이션에 접근 |
| **사후조건** | 인증된 사용자는 홈페이지로 이동, 미인증 사용자는 로그인 페이지 표시 |
| **입력** | - |
| **출력** | 로그인 페이지 또는 홈페이지 |
| **예외 처리** | - 토큰 만료/변조 시 토큰 폐기 후 로그인 이동<br>- 에러 메시지: "로그인을 먼저 진행해 주세요." |
| **이벤트** | `auth_check`, `auth_invalid` |
| **구현 상태** | ✅ 구현 완료 (`router.js`, `auth.js`) |

---

#### FR-AUTH-02: 이메일/비밀번호 로그인

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-02 |
| **기능명** | 이메일/비밀번호 로그인 |
| **우선순위** | P0 |
| **설명** | 이메일과 비밀번호를 사용한 로그인 기능 |
| **전제조건** | 사용자가 로그인 페이지에 있음 |
| **사후조건** | 로그인 성공 시 JWT 토큰 발급 및 홈페이지 이동 |
| **입력** | - 이메일 (필수, 형식 검증)<br>- 비밀번호 (필수, 최소 8자) |
| **출력** | - 성공: JWT 토큰, 사용자 정보<br>- 실패: 에러 메시지 |
| **검증 규칙** | - 이메일 형식: `^[^\s@]+@[^\s@]+\.[^\s@]+$`<br>- 비밀번호: 8자 이상<br>- 사용자 존재 여부 확인<br>- 비밀번호 해시 비교 |
| **예외 처리** | - 형식 오류: "이메일 또는 비밀번호 형식을 확인해 주세요."<br>- 미등록 이메일: "등록되지 않은 이메일입니다. 회원가입을 진행해 주세요."<br>- 비밀번호 불일치: "비밀번호가 일치하지 않습니다." |
| **이벤트** | `login_success`, `login_fail` |
| **구현 상태** | ✅ 구현 완료 (`auth.js`) |

---

#### FR-AUTH-03: Google OAuth 로그인

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-03 |
| **기능명** | Google OAuth 로그인 |
| **우선순위** | P0 |
| **설명** | OAuth 2.0을 통한 Google 계정 로그인 |
| **전제조건** | 사용자가 로그인 페이지에 있음 |
| **사후조건** | 최초 로그인 시 신규 계정 생성, 기존 계정은 로그인 처리 |
| **입력** | Google OAuth 인증 결과 |
| **출력** | - 성공: JWT 토큰, 사용자 정보<br>- 실패: 에러 메시지 |
| **처리 로직** | 1. Google OAuth 인증 요청<br>2. 인증 성공 시 사용자 정보 수신<br>3. 이메일 기준 기존 계정 확인<br>4. 신규 계정 생성 또는 기존 계정 로그인<br>5. JWT 토큰 발급 |
| **예외 처리** | - 인증 취소: "로그인이 취소되었습니다. 다시 진행해 주세요."<br>- 인증 실패: 에러 안내 및 재시도 제공 |
| **이벤트** | `google_login_click`, `google_oauth_success`, `google_oauth_fail` |
| **구현 상태** | ⚠️ 모의 구현 완료 (실제 OAuth 연동 필요) (`auth.js`) |

---

#### FR-AUTH-04: 이메일 회원가입

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-04 |
| **기능명** | 이메일 회원가입 |
| **우선순위** | P0 |
| **설명** | 이메일과 비밀번호를 사용한 신규 계정 생성 |
| **전제조건** | 사용자가 회원가입 탭에 있음 |
| **사후조건** | 가입 성공 시 인증 전환 및 온보딩 페이지 이동 |
| **입력** | - 이메일 (필수, 형식 검증)<br>- 비밀번호 (필수, 최소 8자)<br>- 비밀번호 확인 (필수, 비밀번호와 일치)<br>- 약관 동의 (필수) |
| **출력** | - 성공: JWT 토큰, 사용자 정보<br>- 실패: 에러 메시지 |
| **검증 규칙** | - 이메일 중복 체크<br>- 비밀번호 일치 확인<br>- 약관 동의 필수 |
| **예외 처리** | - 중복 이메일: "이미 가입된 이메일입니다. 로그인을 먼저 진행해 주세요."<br>- 비밀번호 불일치: "비밀번호가 일치하지 않습니다."<br>- 약관 미동의: "가입을 위해 필수 약관 동의가 먼저 필요합니다." |
| **이벤트** | `signup_submit`, `signup_success`, `signup_fail` |
| **구현 상태** | ✅ 구현 완료 (`auth.js`) |

---

#### FR-AUTH-05: 비밀번호 암호화

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-05 |
| **기능명** | 비밀번호 암호화 |
| **우선순위** | P0 |
| **설명** | 비밀번호를 단방향 해시로 암호화하여 저장 |
| **전제조건** | 회원가입 또는 비밀번호 변경 시 |
| **사후조건** | 평문 비밀번호는 저장되지 않음 |
| **입력** | 평문 비밀번호 |
| **출력** | 해시된 비밀번호 |
| **알고리즘** | - 현재: 단순 해시 함수 (개발용)<br>- 운영: bcrypt 또는 argon2 (권장) |
| **예외 처리** | - 해시 실패 시 가입 실패 처리<br>- 에러 메시지: "일시적인 오류입니다. 고객 센터로 문의해 주세요." |
| **이벤트** | `password_hash_success`, `password_hash_fail` |
| **구현 상태** | ⚠️ 개발용 구현 (운영 환경 개선 필요) (`auth.js`) |

---

#### FR-AUTH-06: JWT 토큰 관리

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-06 |
| **기능명** | JWT 토큰 발급 및 관리 |
| **우선순위** | P0 |
| **설명** | 로그인 성공 시 JWT 토큰 발급 및 클라이언트 저장 |
| **전제조건** | 로그인 또는 회원가입 성공 |
| **사후조건** | LocalStorage에 토큰 저장, 만료 시간 포함 |
| **입력** | 사용자 ID |
| **출력** | JWT 토큰 (header.payload.signature) |
| **토큰 구조** | - Header: `{alg: 'HS256', typ: 'JWT'}`<br>- Payload: `{sub: userId, iat: timestamp, exp: timestamp + 24h}`<br>- Signature: 서명 값 |
| **저장 위치** | LocalStorage (`trade_signal_token`) |
| **만료 시간** | 24시간 |
| **예외 처리** | - 저장 실패 시 안내 및 재로그인 유도<br>- 에러 메시지: "인증 정보를 저장하지 못했습니다. 다시 로그인해 주세요." |
| **이벤트** | `jwt_issued`, `jwt_store_success`, `jwt_store_fail` |
| **구현 상태** | ✅ 구현 완료 (`auth.js`) |

---

#### FR-AUTH-07: 인증 가드 (Auth Guard)

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-AUTH-07 |
| **기능명** | 인증 필요 페이지 접근 제어 |
| **우선순위** | P0 |
| **설명** | 인증이 필요한 페이지 접근 시 토큰 검사 및 차단 |
| **전제조건** | 사용자가 인증 필요 페이지 접근 시도 |
| **사후조건** | 인증된 사용자는 페이지 접근, 미인증 사용자는 로그인 페이지로 리다이렉트 |
| **입력** | 요청된 라우트 경로 |
| **출력** | 페이지 렌더링 또는 로그인 페이지 리다이렉트 |
| **검증 로직** | 1. LocalStorage에서 토큰 확인<br>2. 토큰 존재 여부 확인<br>3. 토큰 만료 시간 확인<br>4. 토큰 유효성 검증 |
| **예외 처리** | - 무한 리다이렉트 방지용 return_to TTL 설정<br>- 에러 메시지: "로그인이 필요한 서비스입니다." |
| **이벤트** | `auth_guard_blocked`, `auth_guard_redirect` |
| **구현 상태** | ✅ 구현 완료 (`router.js`) |

---

### 3.2 홈페이지 및 목록

#### FR-HOME-01: 의원 목록 로드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-01 |
| **기능명** | 의원 목록 로드 |
| **우선순위** | P0 |
| **설명** | 최근 10개년 의원의 종합 수익률 데이터 분석 후 목록 표시 |
| **전제조건** | 사용자가 홈페이지에 접근, 인증 완료 |
| **사후조건** | 의원 목록이 화면에 표시됨 |
| **입력** | - |
| **출력** | 의원 목록 (이름, 정당, 소속, 수익률, 거래 건수 등) |
| **데이터 소스** | CSV 파일 (`kevin_hern_trades.csv` 등) |
| **정렬 기준** | 기본값: 수익률 내림차순 |
| **데이터 갱신** | 매일 00:00 스냅샷 가공 데이터 사용 |
| **예외 처리** | - 데이터 로드 실패: "정보를 불러오지 못했습니다. 다시 시도해 주세요."<br>- 스켈레톤 UI 표시 |
| **이벤트** | `list_view`, `list_load_fail` |
| **구현 상태** | ✅ 구현 완료 (`data.js`, `app.js`) |

---

#### FR-HOME-02: 종목 목록 로드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-02 |
| **기능명** | 종목 목록 로드 |
| **우선순위** | P0 |
| **설명** | 최근 3개년 종목의 거래 빈도 높은 순으로 목록 표시 |
| **전제조건** | 사용자가 홈페이지 종목 탭 선택 |
| **사후조건** | 종목 목록이 화면에 표시됨 |
| **입력** | - |
| **출력** | 종목 목록 (티커, 종목명, 현재가, 일일 변동, 거래 건수 등) |
| **데이터 소스** | CSV 파일에서 추출된 종목 데이터 |
| **정렬 기준** | 기본값: 거래 건수 내림차순 |
| **표시 정보** | - 티커 아이콘<br>- 기업명, 섹터<br>- 현재가, 일일 변동률<br>- 거래 건수<br>- 최근 거래일 |
| **예외 처리** | - 데이터 로드 실패: "정보를 불러오지 못했습니다. 다시 시도해 주세요." |
| **이벤트** | `list_view`, `list_load_fail` |
| **구현 상태** | ✅ 구현 완료 (`data.js`, `components.js`) |

---

#### FR-HOME-03: 검색 기능

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-03 |
| **기능명** | 의원/종목 검색 |
| **우선순위** | P0 |
| **설명** | 의원 이름 또는 종목명/티커로 실시간 검색 |
| **전제조건** | 사용자가 홈페이지에 있음 |
| **사후조건** | 검색어에 맞는 결과만 필터링되어 표시 |
| **입력** | 검색어 (텍스트) |
| **출력** | 필터링된 목록 |
| **검색 범위** | - 의원 탭: 이름, 지역구<br>- 종목 탭: 티커, 종목명 |
| **검색 방식** | 부분 일치 (대소문자 구분 없음) |
| **디바운싱** | 300ms 지연 후 검색 실행 |
| **예외 처리** | - 결과 0건: "찾으시는 결과가 없습니다. 조건을 변경해 보세요." |
| **이벤트** | `search_submitted` |
| **구현 상태** | ✅ 구현 완료 (`app.js`) |

---

#### FR-HOME-04: 정렬 기능

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-04 |
| **기능명** | 목록 정렬 |
| **우선순위** | P0 |
| **설명** | 다양한 기준으로 목록 정렬 |
| **전제조건** | 사용자가 홈페이지에 있음 |
| **사후조건** | 선택한 기준으로 목록이 재정렬됨 |
| **입력** | 정렬 기준 (드롭다운 선택) |
| **출력** | 정렬된 목록 |
| **정렬 옵션** | - 수익률순<br>- 거래량순<br>- 최근 거래순<br>- 이름순 |
| **예외 처리** | - |
| **이벤트** | `sort_changed` |
| **구현 상태** | ✅ 구현 완료 (`app.js`) |

---

#### FR-HOME-05: 필터 기능

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-05 |
| **기능명** | 목록 필터링 |
| **우선순위** | P0 |
| **설명** | 정당 또는 섹터별로 목록 필터링 |
| **전제조건** | 사용자가 홈페이지에 있음 |
| **사후조건** | 선택한 필터에 맞는 항목만 표시 |
| **입력** | 필터 값 (드롭다운 선택) |
| **출력** | 필터링된 목록 |
| **필터 옵션** | - 의원 탭: 전체 정당, 민주당, 공화당<br>- 종목 탭: 전체 섹터, 기술, 금융, 소비재, 자동차 |
| **예외 처리** | - 결과 0건: "찾으시는 결과가 없습니다. 조건을 변경해 보세요." |
| **이벤트** | `filter_changed` |
| **구현 상태** | ✅ 구현 완료 (`app.js`) |

---

#### FR-HOME-06: 팔로우 토글

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-06 |
| **기능명** | 의원 팔로우/언팔로우 |
| **우선순위** | P0 |
| **설명** | 의원을 팔로우하여 알림 및 뉴스레터 수신 대상으로 추가 |
| **전제조건** | 사용자가 인증되어 있음 |
| **사후조건** | 팔로우 상태가 LocalStorage에 저장됨 |
| **입력** | 의원 ID |
| **출력** | 팔로우 성공/실패 메시지 |
| **제한사항** | - 무료 사용자: 최대 3명<br>- 유료 사용자: 무제한 |
| **저장 위치** | LocalStorage (`trade_signal_follows`) |
| **예외 처리** | - 한도 초과: "멤버십 업그레이드가 필요합니다." (페이월 표시)<br>- 통신 실패: "잠시 후 다시 시도해 주세요." |
| **이벤트** | `follow_toggle`, `follow_limit_hit` |
| **구현 상태** | ✅ 구현 완료 (`auth.js` UserData, `app.js`) |

---

#### FR-HOME-07: 관심 종목 추가/제거

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-HOME-07 |
| **기능명** | 관심 종목 담기/제거 |
| **우선순위** | P0 |
| **설명** | 종목을 관심 종목으로 추가하여 추적 |
| **전제조건** | 사용자가 인증되어 있음 |
| **사후조건** | 관심 종목 목록이 LocalStorage에 저장됨 |
| **입력** | 종목 ID |
| **출력** | 추가/제거 성공 메시지 |
| **제한사항** | 무료/유료 모두 무제한 |
| **저장 위치** | LocalStorage (`trade_signal_watchlist`) |
| **예외 처리** | - |
| **이벤트** | `watchlist_toggle` |
| **구현 상태** | ✅ 구현 완료 (`auth.js` UserData, `app.js`) |

---

### 3.3 의원 프로필

#### FR-PROFILE-01: 의원 프로필 페이지 로드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-PROFILE-01 |
| **기능명** | 의원 프로필 페이지 로드 |
| **우선순위** | P0 |
| **설명** | 의원 상세 정보, 수익률 그래프, 매매 내역을 포함한 프로필 페이지 표시 |
| **전제조건** | 사용자가 의원 목록에서 의원 클릭 또는 `/politician/:id` 접근 |
| **사후조건** | 의원 프로필 페이지가 렌더링됨 |
| **입력** | 의원 ID (URL 파라미터) |
| **출력** | 프로필 페이지 (요약 정보, 그래프, 거래 내역) |
| **페이지 구성** | 1. 프로필 헤더 (이름, 정당, 소속, 지역구)<br>2. 통계 카드 (수익률, 거래 건수 등)<br>3. 수익률 그래프<br>4. 매매 내역 테이블 |
| **예외 처리** | - ID 유효하지 않음: "존재하지 않는 의원입니다." → 홈으로 이동<br>- 로드 실패: 재시도 버튼 및 홈 이동 CTA 제공 |
| **이벤트** | `view_politician_profile`, `politician_profile_load_fail` |
| **구현 상태** | ✅ 구현 완료 (`app.js`, `components.js`) |

---

#### FR-PROFILE-02: 프로필 요약 정보 표시

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-PROFILE-02 |
| **기능명** | 프로필 요약 정보 카드 |
| **우선순위** | P1 |
| **설명** | 의원의 핵심 요약 정보를 카드 형태로 표시 |
| **전제조건** | 프로필 페이지 로드 완료 |
| **사후조건** | 요약 정보 카드가 표시됨 |
| **입력** | 의원 데이터 |
| **출력** | 요약 정보 카드 |
| **표시 항목** | - 의원명, 소속 (상·하원), 지역구, 활동 상태<br>- 순자산 (현재 기준)<br>- 의정 활동 기간 중 자산 변동 금액 및 변동률<br>- 전체 매매 건수, 전체 거래 규모<br>- 평균 보유 기간 (일 단위)<br>- 최근 매매일<br>- 승률, 평균 거래 금액<br>- 거래당 평균 수익<br>- 시장 지수 대비 성과 |
| **데이터 소스** | 공시 데이터 기반 (실시간 정보 아님) |
| **예외 처리** | - 데이터 누락 시: "정보 없음" 표기, 카드 유지 |
| **이벤트** | `politician_card_view`, `data_missing_log` |
| **구현 상태** | ✅ 부분 구현 (일부 항목만 표시) (`components.js`) |

---

#### FR-PROFILE-03: 수익률 비교 그래프

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-PROFILE-03 |
| **기능명** | 의원 vs S&P 500 수익률 비교 그래프 |
| **우선순위** | P0 |
| **설명** | 의원 포트폴리오와 S&P 500의 누적 수익률을 비교하는 라인 차트 |
| **전제조건** | 프로필 페이지 로드 완료 |
| **사후조건** | Canvas에 그래프가 그려짐 |
| **입력** | 의원 거래 데이터, S&P 500 지수 데이터 |
| **출력** | Canvas 그래프 |
| **차트 구성** | - X축: 날짜<br>- Y축: 누적 수익률 (%)<br>- 의원 포트폴리오: 녹색 실선<br>- S&P 500: 회색 점선<br>- 0% 기준선: 시작일 기준선 |
| **데이터 계산** | Net Worth 방법 사용 ($10,000 초기 투자) |
| **기준 전환** | - 거래일 기준: `price_trade_date` 사용<br>- 공시일 기준: `price_filing_date` 사용 (토글 버튼) |
| **데이터 갱신** | 일 1회 (00:00) 스냅샷 갱신 |
| **예외 처리** | - 데이터 누락 시: 가용 구간만 표기 후 안내<br>- 데이터 없음: "거래 데이터가 없습니다." 메시지 |
| **이벤트** | `view_compare_chart`, `compare_chart_load_fail` |
| **구현 상태** | ✅ 구현 완료 (`app.js` drawPerformanceChart) |

---

#### FR-PROFILE-04: 매매 내역 테이블

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-PROFILE-04 |
| **기능명** | 매매 내역 테이블 |
| **우선순위** | P0 |
| **설명** | 의원의 모든 거래 내역을 테이블 형태로 표시 |
| **전제조건** | 프로필 페이지 로드 완료 |
| **사후조건** | 거래 내역 테이블이 표시됨 |
| **입력** | 의원 ID |
| **출력** | 거래 내역 테이블 |
| **테이블 컬럼** | - 종목 (티커, 종목명)<br>- 유형 (매수/매도)<br>- 거래일<br>- 종가<br>- 금액 범위<br>- 추정 수량<br>- 소유자<br>- 출처 링크 |
| **정렬** | 공시일 최신순 (기본값) |
| **페이지네이션** | 무한 스크롤 또는 페이지네이션 (구현 예정) |
| **예외 처리** | - 내역 0건: Empty 상태 표시 |
| **이벤트** | `view_trade_list`, `trade_list_load_more`, `click_trade_row` |
| **구현 상태** | ✅ 구현 완료 (`components.js`) |

---

#### FR-PROFILE-05: 원문 출처 노출

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-PROFILE-05 |
| **기능명** | SEC 공시 원문 링크 표시 |
| **우선순위** | P0 |
| **설명** | 모든 거래 데이터에 SEC/STOCK Act 공시 원문 URL 표시 |
| **전제조건** | 거래 데이터에 출처 정보 포함 |
| **사후조건** | 출처 링크가 표시됨 |
| **입력** | 거래 데이터 (sourceUrl, sourceId) |
| **출력** | 출처 링크 버튼 |
| **링크 형식** | - PDF URL 직접 링크<br>- 또는 `https://disclosures-clerk.house.gov/public_disc/ptr-pdfs/{year}/{filingId}.pdf` |
| **표시 정보** | - Source ID<br>- 데이터 수집 타임스탬프 (옵션) |
| **예외 처리** | - 출처 부재: "출처 미확인" 문구 표시, 배지 없음 |
| **이벤트** | `view_source_stamp` |
| **구현 상태** | ✅ 구현 완료 (`components.js`) |

---

### 3.4 거래 상세

#### FR-TRADE-01: 거래 상세 페이지 로드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-TRADE-01 |
| **기능명** | 거래 상세 페이지 로드 |
| **우선순위** | P0 |
| **설명** | 개별 거래의 상세 정보, 주가 추이 그래프, 관련 거래 히스토리 표시 |
| **전제조건** | 사용자가 거래 내역 테이블에서 거래 클릭 또는 `/trade/:id` 접근 |
| **사후조건** | 거래 상세 페이지가 렌더링됨 |
| **입력** | 거래 ID (URL 파라미터) |
| **출력** | 거래 상세 페이지 (정보, 그래프, 히스토리) |
| **페이지 구성** | 1. 거래 헤더 (종목명, 티커, 매매 유형)<br>2. 상세 정보 그리드<br>3. 주가 추이 그래프<br>4. 관련 거래 히스토리 |
| **예외 처리** | - ID 유효하지 않음: "존재하지 않는 거래입니다." → 홈으로 이동<br>- 로드 실패: 이전 화면 복귀 CTA 제공 |
| **이벤트** | `trade_detail_view`, `trade_detail_load_fail` |
| **구현 상태** | ✅ 구현 완료 (`app.js`, `components.js`) |

---

#### FR-TRADE-02: 주가 추이 그래프

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-TRADE-02 |
| **기능명** | 주가 추이 그래프 |
| **우선순위** | P0 |
| **설명** | 거래일부터 현재까지의 주가 추이를 그래프로 표시 |
| **전제조건** | 거래 상세 페이지 로드 완료 |
| **사후조건** | Canvas에 주가 그래프가 그려짐 |
| **입력** | 거래 데이터 (거래일, 현재가 등) |
| **출력** | Canvas 그래프 |
| **차트 구성** | - X축: 날짜<br>- Y축: 주가 ($)<br>- 가격 라인: 파란색 실선<br>- 거래일 마커: 녹색 원<br>- 공시일 마커: 주황색 원 |
| **데이터 소스** | - 거래일 가격: `price_trade_date`<br>- 현재가: 마지막 거래 종가 또는 추정값<br>- 중간 가격: 랜덤 변동 시뮬레이션 (실제 API 연동 필요) |
| **예외 처리** | - 데이터 지연 시 기준 시각 노출<br>- 데이터 누락 시 해당 마커만 숨김 처리 |
| **이벤트** | `view_stock_chart`, `chart_load_success`, `chart_load_fail` |
| **구현 상태** | ✅ 구현 완료 (`app.js` drawStockChart) |

---

#### FR-TRADE-03: 거래 상세 정보 카드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-TRADE-03 |
| **기능명** | 거래 상세 정보 카드 |
| **우선순위** | P0 |
| **설명** | 거래의 상세 정보를 그리드 형태로 표시 |
| **전제조건** | 거래 상세 페이지 로드 완료 |
| **사후조건** | 상세 정보 그리드가 표시됨 |
| **입력** | 거래 데이터 |
| **출력** | 정보 그리드 |
| **표시 항목** | - 의원명, 정당, 지역<br>- 거래일, 공시일<br>- 공시 지연 일수 (Lag = 공시일 - 거래일)<br>- 소유자 (Self/Spouse/Dependent Child/Joint)<br>- 거래 규모 (금액 범위)<br>- 거래일 종가<br>- 추정 수량<br>- Filing ID |
| **출처 링크** | SEC 공시 PDF 링크 제공 |
| **예외 처리** | - 추정 단가: 거래일의 매물대분석, 거래량 기반 추정 또는 '미제공' 중 선택 적용 |
| **이벤트** | `view_source_stamp` |
| **구현 상태** | ✅ 구현 완료 (`components.js`) |

---

#### FR-TRADE-04: 관련 거래 히스토리

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-TRADE-04 |
| **기능명** | 종목별 거래 히스토리 |
| **우선순위** | P0 |
| **설명** | 해당 의원의 동일 종목 거래 히스토리 제공 |
| **전제조건** | 거래 상세 페이지 로드 완료, 관련 거래 존재 |
| **사후조건** | 관련 거래 히스토리 테이블이 표시됨 |
| **입력** | 의원 ID, 티커 |
| **출력** | 거래 히스토리 테이블 |
| **테이블 컬럼** | - 유형 (매수/매도)<br>- 거래일<br>- 공시일<br>- 지연 일수<br>- 금액 범위<br>- 소유자 |
| **정렬** | 공시일 최신순 |
| **예외 처리** | - 히스토리 0건: Empty 상태 표시 |
| **이벤트** | `view_stock_trade_history`, `click_stock_trade_history_row` |
| **구현 상태** | ✅ 구현 완료 (`components.js`) |

---

### 3.5 온보딩

#### FR-ONBOARD-01: 온보딩 가드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-ONBOARD-01 |
| **기능명** | 온보딩 가드 |
| **우선순위** | P0 |
| **설명** | 최초 로그인 시 온보딩 페이지로 강제 리다이렉트 |
| **전제조건** | 사용자가 최초 로그인 (onboarding_status=NOT_STARTED) |
| **사후조건** | 온보딩 완료 전 타 페이지 접근 차단 |
| **입력** | 온보딩 상태 |
| **출력** | 온보딩 페이지 또는 허용된 페이지 |
| **검증 로직** | LocalStorage에서 `trade_signal_onboarding` 확인 |
| **예외 처리** | - 상태 조회 실패: 재시도 안내 및 로그아웃 버튼 제공 |
| **이벤트** | `onboarding_gate_check`, `onboarding_gate_blocked` |
| **구현 상태** | ✅ 구현 완료 (`router.js`) |

---

#### FR-ONBOARD-02: 온보딩 단계 구성

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-ONBOARD-02 |
| **기능명** | 온보딩 단계 진행 관리 |
| **우선순위** | P0 |
| **설명** | 2단계 온보딩 프로세스 관리 |
| **전제조건** | 사용자가 온보딩 페이지에 접근 |
| **사후조건** | 단계별 진행 상태가 표시됨 |
| **입력** | 현재 단계 |
| **출력** | 온보딩 페이지 (진행률 표시) |
| **단계 구성** | - Step 1: 관심 의원 팔로우 (1명 필수)<br>- Step 2: 관심 종목 담기 (선택/다중) |
| **진행률 표시** | 상단에 진행률 (1/2, 2/2) 표시 |
| **제약사항** | Step 1 완료 전 Step 2 진입 불가 |
| **상태 유지** | 새로고침 시 진행 중이던 단계 유지 |
| **예외 처리** | - |
| **이벤트** | `onboarding_start`, `onboarding_step_view` |
| **구현 상태** | ✅ 구현 완료 (`app.js`, `components.js`) |

---

#### FR-ONBOARD-03: Step 1 - 의원 팔로우

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-ONBOARD-03 |
| **기능명** | 온보딩 Step 1: 의원 팔로우 |
| **우선순위** | P0 |
| **설명** | 수익률 내림차순 후보 리스트에서 의원 1명 필수 선택 |
| **전제조건** | 사용자가 온보딩 Step 1에 있음 |
| **사후조건** | 의원 선택 시 다음 단계 버튼 활성화 |
| **입력** | 의원 ID (클릭) |
| **출력** | 선택된 의원 표시, 다음 버튼 활성화 |
| **데이터 표시** | - 이름, 정당, 상·하원<br>- 10년 수익률 정보 |
| **정렬** | 수익률 내림차순 |
| **제약사항** | 반드시 1명의 의원을 팔로우해야 다음 단계 이동 가능<br>선택 시 기존 선택 해제 후 교체 |
| **예외 처리** | - 데이터 로드 실패: 재시도 안내<br>- 저장 실패: 재시도 안내 |
| **이벤트** | `onboarding_politician_list_view`, `onboarding_follow_select` |
| **구현 상태** | ✅ 구현 완료 (`app.js`, `components.js`) |

---

#### FR-ONBOARD-04: Step 2 - 종목 검색 및 선택

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-ONBOARD-04 |
| **기능명** | 온보딩 Step 2: 관심 종목 선택 |
| **우선순위** | P0 |
| **설명** | 티커 또는 종목명으로 검색하여 관심 종목 추가 |
| **전제조건** | 사용자가 온보딩 Step 2에 있음 |
| **사후조건** | 선택한 종목이 관심 종목 목록에 추가됨 |
| **입력** | 검색어 (티커 또는 종목명) |
| **출력** | 검색 결과 리스트, 선택된 종목 표시 |
| **검색 기능** | 상단 검색창에서 티커 또는 종목명 검색 지원 |
| **리스트 표시** | - 티커 아이콘<br>- 기업명, 섹터<br>- 최근 거래 의원 정보<br>- 현재가, 일일 변동률<br>- 거래 건수, 최근 거래일 |
| **선택 기능** | 리스트 우측의 '담기' 버튼 클릭 시 즉시 추가 |
| **제약사항** | 선택 사항 (다중 선택 가능) |
| **예외 처리** | - 중복 티커 추가: "이미 추가된 종목입니다." 인라인 에러<br>- 검색 결과 없음: '직접 입력해서 추가' 옵션 제공 (구현 예정) |
| **이벤트** | `onboarding_ticker_search_submit`, `onboarding_ticker_add`, `onboarding_ticker_select` |
| **구현 상태** | ✅ 구현 완료 (`app.js`, `components.js`) |

---

#### FR-ONBOARD-05: 온보딩 완료

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-ONBOARD-05 |
| **기능명** | 온보딩 완료 처리 |
| **우선순위** | P0 |
| **설명** | Step 2 완료 시 온보딩 완료 처리 및 홈페이지 이동 |
| **전제조건** | Step 1 완료, Step 2에서 '시작하기' 버튼 클릭 |
| **사후조건** | 온보딩 상태가 'completed'로 저장, 홈페이지 이동 |
| **입력** | 선택된 의원 ID, 선택된 종목 ID 배열 |
| **출력** | 홈페이지 |
| **저장 처리** | - 팔로우 목록에 의원 추가<br>- 관심 종목 목록에 종목 추가<br>- LocalStorage에 `trade_signal_onboarding = 'completed'` 저장 |
| **예외 처리** | - 저장 실패: 재시도 안내 |
| **이벤트** | `onboarding_complete` |
| **구현 상태** | ✅ 구현 완료 (`app.js`, `auth.js`) |

---

### 3.6 설정 및 구독

#### FR-SETTINGS-01: 설정 페이지

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SETTINGS-01 |
| **기능명** | 사용자 설정 페이지 |
| **우선순위** | P0 |
| **설명** | 알림 설정, 구독 관리 등 사용자 설정 관리 |
| **전제조건** | 사용자가 인증되어 있음 |
| **사후조건** | 설정 페이지가 표시됨 |
| **입력** | - |
| **출력** | 설정 페이지 |
| **설정 항목** | - 계정 정보 (이메일)<br>- 이메일 알림 (ON/OFF)<br>- 주간 뉴스레터 (ON/OFF)<br>- 구독 정보 (현재 플랜)<br>- 계정 관리 (로그아웃) |
| **저장 위치** | LocalStorage (`trade_signal_settings`) |
| **예외 처리** | - |
| **이벤트** | `settings_view` |
| **구현 상태** | ✅ 구현 완료 (`components.js`) |

---

#### FR-SETTINGS-02: 알림 설정 토글

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SETTINGS-02 |
| **기능명** | 이메일 알림 설정 |
| **우선순위** | P0 |
| **설명** | 팔로우한 의원의 새로운 거래 알림 ON/OFF 설정 |
| **전제조건** | 사용자가 설정 페이지에 있음 |
| **사후조건** | 설정이 LocalStorage에 저장됨 |
| **입력** | 알림 ON/OFF 토글 |
| **출력** | 저장 성공 메시지 |
| **기본값** | ON |
| **동작** | OFF 시 큐 적재 전 필터링 (실제 발송 기능 구현 예정) |
| **예외 처리** | - 기적재된 건은 발송될 수 있음을 UI 안내 |
| **이벤트** | `email_subscribe`, `email_unsubscribe` (source=inapp) |
| **구현 상태** | ✅ UI 구현 완료 (실제 발송 기능 구현 예정) (`auth.js` UserData) |

---

#### FR-SETTINGS-03: 뉴스레터 설정

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SETTINGS-03 |
| **기능명** | 주간 뉴스레터 구독 설정 |
| **우선순위** | P1 |
| **설명** | 매주 토요일 발송되는 주간 요약 뉴스레터 구독 ON/OFF |
| **전제조건** | 사용자가 설정 페이지에 있음 |
| **사후조건** | 설정이 LocalStorage에 저장됨 |
| **입력** | 뉴스레터 ON/OFF 토글 |
| **출력** | 저장 성공 메시지 |
| **기본값** | ON |
| **발송 주기** | 매주 토요일 10:00 (KST) |
| **예외 처리** | - 미인증 계정 시 이메일 입력 강제<br>- 저장 실패 시 재시도 CTA 제공 |
| **이벤트** | `newsletter_subscribe`, `newsletter_unsubscribe` |
| **구현 상태** | ✅ UI 구현 완료 (실제 발송 기능 구현 예정) (`auth.js` UserData) |

---

#### FR-SUB-01: 페이월 표시

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SUB-01 |
| **기능명** | 유료 구독 페이월 모달 |
| **우선순위** | P0 |
| **설명** | 제한 기능 클릭 시 페이월 모달 표시 |
| **전제조건** | 무료 사용자가 제한 기능 클릭 (예: 팔로우 3명 초과) |
| **사후조건** | 페이월 모달이 표시됨 |
| **입력** | - |
| **출력** | 페이월 모달 |
| **모달 구성** | - 무료 vs 유료 혜택 비교<br>- 플랜 선택 (월간/연간)<br>- 구독 시작하기 버튼<br>- 구독 해지 기능 (하단) |
| **제약사항** | 구독자에게는 미노출 |
| **예외 처리** | - 페이월 로드 실패: 재시도 및 기본 안내 문구 제공 |
| **이벤트** | `paywall_view`, `click_unlock_range`, `click_paywall` |
| **구현 상태** | ✅ UI 구현 완료 (결제 연동 필요) (`components.js`) |

---

#### FR-SUB-02: 결제 정보 입력

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SUB-02 |
| **기능명** | 결제 정보 입력 화면 |
| **우선순위** | P0 |
| **설명** | 플랜 선택 후 결제 정보 입력 화면 |
| **전제조건** | 사용자가 페이월에서 플랜 선택 |
| **사후조건** | 결제 정보 입력 화면이 표시됨 |
| **입력** | - 카드번호<br>- 유효기간 (MM/YY)<br>- CVV<br>- 카드소유자명<br>- 청구이메일<br>- 국가·지역 |
| **출력** | 주문요약 (우측), 결제 버튼 |
| **주문요약** | - 플랜, 결제주기<br>- 원가, 할인, 총 결제금액 (실시간 표시) |
| **검증** | - 필수값 누락/형식 오류 시 결제 버튼 비활성 또는 에러 표기<br>- 서비스 이용약관/개인정보 처리방침 동의 (필수)<br>- 자동갱신 동의 (필수) |
| **예외 처리** | - 네트워크 오류/결제창 닫힘/중복 클릭: 재시도 CTA 및 버튼 disable 처리 |
| **이벤트** | `checkout_view`, `checkout_input_error`, `checkout_submit`, `checkout_submit_fail` |
| **구현 상태** | ⚠️ 구현 예정 (결제 연동 필요) |

---

#### FR-SUB-03: 결제 처리

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SUB-03 |
| **기능명** | 결제 처리 및 구독 생성 |
| **우선순위** | P0 |
| **설명** | 결제 요청 생성 및 승인/실패 처리 |
| **전제조건** | 사용자가 결제 정보 입력 완료 및 결제 버튼 클릭 |
| **사후조건** | 결제 성공 시 구독 생성, 실패 시 에러 처리 |
| **입력** | 결제 정보, 플랜 정보 |
| **출력** | 결제 성공/실패 화면 |
| **처리 로직** | 1. 결제 요청 생성 (idempotency_key 사용)<br>2. 결제 승인/실패 결과 수신<br>3. 서버가 확정 저장<br>4. 구독 정보 업데이트 |
| **중복 방지** | idempotency_key (member_id + order_id) 사용 |
| **예외 처리** | - 타임아웃/5xx: 결제 상태 UNKNOWN 처리, '결제 결과 확인 중' 안내 및 재조회/재시도 제공 |
| **로그** | order_id, member_id, plan_id, amount, discount, status, provider_tx_id, fail_reason 저장 |
| **이벤트** | `payment_start`, `payment_success`, `payment_fail` |
| **구현 상태** | ⚠️ 구현 예정 (결제 연동 필요) |

---

#### FR-SUB-04: 구독 관리

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-SUB-04 |
| **기능명** | 구독 관리 화면 |
| **우선순위** | P0 |
| **설명** | 현재 구독 정보 조회 및 관리 |
| **전제조건** | 사용자가 구독 관리 페이지 접근 |
| **사후조건** | 구독 정보가 표시됨 |
| **입력** | - |
| **출력** | 구독 관리 화면 |
| **표시 정보** | - 현재 플랜 (연간/월간)<br>- 결제금액, 다음 결제일<br>- 구독 시작일<br>- 결제수단 (마스킹)<br>- 결제 내역 (최근 1건 + 영수증 보기)<br>- 프리미엄 기능 리스트 |
| **CTA** | - 다른 플랜 보기<br>- 영수증 보기<br>- 구독 해지 |
| **예외 처리** | - 결제/구독 정보 조회 실패: 재시도 CTA 및 기본 안내 문구 제공 |
| **이벤트** | `subscription_manage_view`, `click_view_plans`, `click_receipt_view`, `subscription_info_load_fail` |
| **구현 상태** | ⚠️ UI 구현 완료 (결제 연동 필요) (`components.js`) |

---

### 3.7 데이터 처리 및 계산

#### FR-DATA-01: CSV 데이터 로드

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-DATA-01 |
| **기능명** | CSV 파일 파싱 및 로드 |
| **우선순위** | P0 |
| **설명** | 의원 거래 데이터 CSV 파일을 파싱하여 JavaScript 객체로 변환 |
| **전제조건** | 애플리케이션 초기화 시 |
| **사후조건** | 거래 데이터가 전역 변수에 저장됨 |
| **입력** | CSV 파일 (예: `kevin_hern_trades.csv`) |
| **출력** | 거래 객체 배열 |
| **CSV 구조** | `year, filing_date, owner, asset, ticker, type, transaction_date, amount_range, price_trade_date, price_filing_date, pdf_url` |
| **파싱 규칙** | - 날짜 변환: `MM/DD/YYYY` → `YYYY-MM-DD`<br>- 금액 범위 파싱: `$1,000 - $15,000` → 중간값 계산<br>- 거래 타입 변환: `purchase` → `buy`, `sale` → `sell`, `exchange` → 제외 |
| **예외 처리** | - 파일 로드 실패: 콘솔 경고, 빈 배열 반환 |
| **구현 상태** | ✅ 구현 완료 (`data.js`) |

---

#### FR-DATA-02: S&P 500 데이터 처리

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-DATA-02 |
| **기능명** | S&P 500 지수 데이터 로드 및 처리 |
| **우선순위** | P0 |
| **설명** | S&P 500 일별 지수 데이터를 로드하거나 폴백 데이터 생성 |
| **전제조건** | 애플리케이션 초기화 시 |
| **사후조건** | S&P 500 데이터가 전역 변수에 저장됨 |
| **입력** | JSON 파일 (`sp500_history.json`) 또는 없음 |
| **출력** | S&P 500 일별 지수 배열 |
| **데이터 소스** | 1. `sp500_history.json` (실제 데이터, `fetch_sp500.py`로 생성)<br>2. 폴백: 날짜별 연 10% 성장 곡선 (확정 곡선) |
| **폴백 로직** | `가치 = startValue × (1.10)^(일수/365)` (날짜만으로 결정, 새로고침해도 동일) |
| **날짜별 조회** | 특정 날짜의 S&P 500 종가 반환 (가장 가까운 이전 값 사용) |
| **예외 처리** | - 파일 로드 실패: 폴백 데이터 사용, 콘솔 경고 |
| **구현 상태** | ✅ 구현 완료 (`data.js`) |

---

#### FR-DATA-03: 매수 선행 필터

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-DATA-03 |
| **기능명** | 매수 선행 티커 필터링 |
| **우선순위** | P0 |
| **설명** | 각 티커의 첫 거래가 매수인 경우만 수익률 계산에 포함 |
| **전제조건** | 거래 데이터 로드 완료 |
| **사후조건** | 매수 선행 티커만 필터링됨 |
| **입력** | 거래 배열 |
| **출력** | 매수 선행 티커 Set |
| **필터 로직** | 1. 티커별로 거래 그룹화<br>2. 각 티커의 거래를 날짜순 정렬<br>3. 첫 거래가 `buy`인 경우만 포함<br>4. 첫 거래가 `sell`인 경우 해당 티커 전체 제외 |
| **예외 처리** | - |
| **구현 상태** | ✅ 구현 완료 (`data.js` getBuyFirstTickers) |

---

#### FR-DATA-04: Net Worth 방법 수익률 계산

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-DATA-04 |
| **기능명** | Net Worth 방법 포트폴리오 시뮬레이션 |
| **우선순위** | P0 |
| **설명** | $10,000 초기 투자로 의원 거래를 따라가며 포트폴리오 가치 계산 |
| **전제조건** | 의원 거래 데이터 및 S&P 500 데이터 로드 완료 |
| **사후조건** | 일별 포트폴리오 가치 및 수익률 계산 완료 |
| **입력** | 의원 ID, 가격 기준 타입 (`trade` 또는 `disclosure`) |
| **출력** | 일별 포트폴리오 가치 배열, 최종 수익률 |
| **시뮬레이션 규칙** | - 초기 현금: $10,000<br>- BUY: 보유 수량 증가, 현금 감소<br>- SELL: 보유 수량 감소, 매도 대금은 현금으로 전환 (재투자 없음) |
| **일별 가치 계산** | `의원 포트폴리오 가치_t = Σ(보유수량 × 당일가격) + 현금`<br>`S&P 500 가치_t = $10,000 × (지수_t / 지수_0)` |
| **누적 수익률** | `누적 수익률_t = (가치_t / 가치_0 - 1) × 100 (%)` |
| **가격 기준** | - 거래일 기준: `price_trade_date` 사용<br>- 공시일 기준: `price_filing_date` 사용 |
| **예외 처리** | - 데이터 없음: null 반환 |
| **구현 상태** | ✅ 구현 완료 (`data.js` calculateNetWorthPortfolio) |

---

#### FR-DATA-05: 거래 기반 수익률 계산

| 항목 | 내용 |
|------|------|
| **기능 ID** | FR-DATA-05 |
| **기능명** | 매수-매도 쌍 기준 수익률 계산 |
| **우선순위** | P0 |
| **설명** | FIFO 방식으로 매수-매도 쌍을 매칭하여 거래별 수익률 계산 |
| **전제조건** | 의원 거래 데이터 로드 완료 |
| **사후조건** | 거래별 수익률, 평균 수익률, 승률 등 계산 완료 |
| **입력** | 의원 거래 배열 |
| **출력** | 수익률 통계 (평균 수익률, 승률, 시장 초과 비율 등) |
| **매칭 로직** | 1. 티커별로 매수/매도 그룹화<br>2. 날짜순 정렬<br>3. 각 매도에 대해 가장 가까운 이전 매수 찾기 (FIFO)<br>4. 실현 수익률 계산: `(매도가 - 매수가) / 매수가 × 100`<br>5. 매칭되지 않은 매수는 현재가 기준 미실현 수익률 계산 |
| **S&P 500 비교** | 동일 기간 S&P 500 수익률 계산 및 비교 |
| **통계 계산** | - 평균 수익률<br>- 승률 (수익 거래 비율)<br>- 시장 초과 비율<br>- 평균 보유 기간 |
| **예외 처리** | - |
| **구현 상태** | ✅ 구현 완료 (`data.js`) |

---

## 4. 데이터 요구사항

### 4.1 데이터 소스

| 데이터 타입 | 소스 | 형식 | 갱신 주기 |
|-----------|------|------|----------|
| 의원 거래 데이터 | STOCK Act 공시 | CSV | 수동 업로드 |
| S&P 500 지수 | yfinance API | JSON | `fetch_sp500.py` 실행 시 |
| 주가 데이터 | CSV (거래일 종가) | 숫자 | 거래 데이터와 함께 |

### 4.2 데이터 구조

#### 의원 거래 데이터 (CSV)
```csv
year, filing_date, owner, asset, ticker, type, transaction_date, amount_range, price_trade_date, price_filing_date, pdf_url
```

#### S&P 500 데이터 (JSON)
```json
[
  {"date": "2018-12-01", "close": 2500.00},
  ...
]
```

### 4.3 데이터 정제 규칙

- **날짜 변환**: `MM/DD/YYYY` → `YYYY-MM-DD`
- **금액 범위 파싱**: `$1,000 - $15,000` → 중간값 `$8,000`
- **거래 타입 정규화**: `purchase` → `buy`, `sale` → `sell`, `exchange` → 제외
- **가격 데이터**: 거래일 가격(`price_trade_date`) 및 공시일 가격(`price_filing_date`) 모두 사용

---

## 5. 비기능 요구사항

### 5.1 성능

| 항목 | 요구사항 | 현재 상태 |
|------|---------|----------|
| 초기 로딩 시간 | < 3초 | ✅ 달성 |
| 차트 렌더링 | < 1초 | ✅ 달성 |
| 검색 응답 시간 | < 300ms (디바운싱) | ✅ 달성 |
| 페이지 전환 | < 500ms | ✅ 달성 |

### 5.2 사용성

| 항목 | 요구사항 | 현재 상태 |
|------|---------|----------|
| 반응형 디자인 | 모바일/태블릿/데스크톱 지원 | ⚠️ 부분 지원 |
| 접근성 | 키보드 네비게이션, 스크린 리더 지원 | ⚠️ 미구현 |
| 에러 메시지 | 명확하고 실행 가능한 안내 | ✅ 달성 |

### 5.3 신뢰성

| 항목 | 요구사항 | 현재 상태 |
|------|---------|----------|
| 데이터 정확성 | 계산 방법론 공개 및 검증 가능 | ✅ 달성 |
| 오류 처리 | 모든 예외 상황에 대한 처리 | ✅ 달성 |
| 데이터 백업 | LocalStorage 데이터 손실 대비 | ⚠️ 미구현 |

### 5.4 보안

| 항목 | 요구사항 | 현재 상태 |
|------|---------|----------|
| 비밀번호 암호화 | bcrypt/argon2 사용 | ⚠️ 개발용 구현 |
| JWT 토큰 검증 | 서버 사이드 검증 | ⚠️ 클라이언트만 구현 |
| 데이터 저장 | 민감 정보 암호화 | ⚠️ LocalStorage 평문 저장 |

### 5.5 확장성

| 항목 | 요구사항 | 현재 상태 |
|------|---------|----------|
| 다중 의원 지원 | 동일 구조로 확장 가능 | ✅ 달성 |
| 데이터 소스 확장 | 다양한 CSV 형식 지원 | ⚠️ 현재 형식만 지원 |
| API 연동 | 실시간 주가 API 연동 가능 | ⚠️ 미구현 |

---

## 6. 인터페이스 요구사항

### 6.1 사용자 인터페이스

#### 화면 구성
- **로그인 페이지**: 중앙 정렬 카드 레이아웃
- **홈페이지**: 탭, 검색/필터 바, 리스트 컨테이너
- **의원 프로필**: 헤더, 통계 카드, 차트, 거래 테이블
- **거래 상세**: 헤더, 정보 그리드, 차트, 히스토리

#### 디자인 시스템
- **색상**: 
  - Primary: 민주당 (파란색), 공화당 (빨간색)
  - Success: 녹색 (#22c55e)
  - Danger: 빨간색 (#ef4444)
  - Neutral: 회색 (#94a3b8)
- **타이포그래피**: Inter 폰트
- **아이콘**: Font Awesome 6.4.0

### 6.2 외부 인터페이스

#### 현재
- **CSV 파일**: 로컬 파일 시스템
- **JSON 파일**: 로컬 파일 시스템

#### 향후 계획
- **주가 API**: yfinance 또는 Alpha Vantage
- **인증 서버**: OAuth 2.0, JWT 검증
- **결제 게이트웨이**: Stripe 또는 유사 서비스

---

## 7. 제약사항 및 가정

### 7.1 제약사항

1. **데이터 소스**: STOCK Act 공시 데이터에 의존 (공시 지연 가능)
2. **실시간성**: CSV 기반 데이터로 실시간 업데이트 없음
3. **주가 데이터**: 마지막 거래 종가 기준 (실시간 API 연동 필요)
4. **브라우저 지원**: LocalStorage 지원 브라우저만 지원
5. **인증**: 현재 클라이언트 사이드만 구현 (서버 검증 필요)

### 7.2 가정

1. **초기 투자**: 모든 의원 포트폴리오 시뮬레이션은 $10,000으로 시작
2. **매수 선행**: 첫 거래가 매수인 종목만 수익률 계산에 포함
3. **S&P 500 비교**: 동일 시작일 기준으로 $10,000 투자 가정
4. **가격 데이터**: 거래일 가격 또는 공시일 가격 사용 (실시간 가격 아님)
5. **사용자 제한**: 무료 사용자는 최대 3명의 의원만 팔로우 가능

### 7.3 알려진 제한사항

1. **비밀번호 보안**: 현재 단순 해시 함수 사용 (운영 환경 개선 필요)
2. **JWT 검증**: 클라이언트 사이드만 구현 (서버 검증 필요)
3. **결제 연동**: UI만 구현, 실제 결제 처리 미구현
4. **이메일 발송**: 설정만 구현, 실제 발송 기능 미구현
5. **뉴스레터**: 설정만 구현, 실제 발송 기능 미구현
6. **반응형 디자인**: 데스크톱 중심, 모바일 최적화 필요

---

## 부록

### A. 용어 정의

- **Net Worth 방법**: 초기 투자금으로 포트폴리오를 시뮬레이션하여 가치 변화를 추적하는 방법
- **매수 선행**: 특정 티커의 첫 거래가 매수인 경우
- **FIFO**: First In First Out, 먼저 매수한 주식을 먼저 매도하는 방식
- **STOCK Act**: Stop Trading on Congressional Knowledge Act, 의원 거래 공시 의무화 법률

### B. 참고 문서

- `수익률_계산_로직.md`: 수익률 계산 로직 상세 설명
- `requirements.md`: 초기 기능 요구사항 명세
- `프로젝트_전체_분석.md`: 프로젝트 전체 분석 문서

### C. 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-28 | 초기 요구사항 명세서 작성 | - |

---

**문서 끝**
