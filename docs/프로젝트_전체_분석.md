# Trade Signal 프로젝트 전체 분석 및 기능 설계 정리

## 📋 프로젝트 개요

**Trade Signal**은 미국 의원들의 주식 거래 내역을 추적하고 분석하는 웹 애플리케이션입니다. 의원들의 거래 데이터를 기반으로 포트폴리오 성과를 계산하고, S&P 500 지수와 비교하여 시각화합니다.

---

## 🛠 기술 스택

### 프론트엔드
- **HTML5/CSS3/JavaScript (Vanilla)**: 프레임워크 없이 순수 JavaScript로 구현
- **Canvas API**: 차트 시각화 (수익률 그래프, 주가 추이)
- **LocalStorage**: 사용자 데이터, 인증 정보, 팔로우/관심종목 저장

### 백엔드/데이터 처리
- **Python**: 데이터 분석 및 S&P 500 데이터 수집
  - `pandas`: CSV 데이터 처리
  - `yfinance`: S&P 500 및 주가 데이터 조회
  - `matplotlib`: 포트폴리오 비교 그래프 생성

### 데이터 소스
- **CSV 파일**: 의원별 거래 내역 (`kevin_hern_trades.csv`, `byron_donalds_all_transaction.csv`)
- **JSON 파일**: S&P 500 일별 지수 데이터 (`sp500_history.json`)

---

## 📁 프로젝트 구조

```
shinhan_4/
├── index.html              # 메인 HTML 파일
├── css/
│   └── style.css          # 스타일시트
├── js/
│   ├── app.js            # 메인 애플리케이션 로직
│   ├── auth.js           # 인증 모듈
│   ├── components.js    # UI 컴포넌트 렌더링
│   ├── data.js          # 데이터 로드 및 처리
│   └── router.js        # 라우팅 및 유틸리티
├── kevin_hern_trades.csv # Kevin Hern 의원 거래 데이터
├── fetch_sp500.py       # S&P 500 데이터 수집 스크립트
├── networth_portfolio_comparison.py # 포트폴리오 비교 분석 스크립트
├── sp500_history.json   # S&P 500 일별 지수 데이터
└── 수익률_계산_로직.md   # 수익률 계산 로직 상세 문서
```

---

## 🎯 주요 기능별 설계 내용

### 1. 인증 시스템 (`auth.js`)

#### 1.1 로그인/회원가입
- **이메일/비밀번호 로그인**: 이메일 형식 검증, 비밀번호 해시 비교
- **Google OAuth 로그인**: 모의 구현 (실제 OAuth 연동 필요)
- **JWT 토큰 관리**: 클라이언트 사이드에서 토큰 생성 및 검증
- **세션 관리**: LocalStorage 기반 토큰 저장, 만료 시간 체크

#### 1.2 보안 정책
- **비밀번호 해시**: 단순 해시 함수 사용 (실제 환경에서는 bcrypt/argon2 필요)
- **이메일 중복 체크**: LocalStorage 기반 유니크 검증
- **약관 동의**: 필수 약관 동의 체크박스

#### 1.3 온보딩 관리
- **온보딩 상태 추적**: LocalStorage에 완료 여부 저장
- **온보딩 가드**: 미완료 시 온보딩 페이지로 강제 리다이렉트

---

### 2. 라우팅 시스템 (`router.js`)

#### 2.1 라우트 등록
- **해시 기반 라우팅**: `window.location.hash` 사용
- **동적 라우트**: `/politician/:id`, `/trade/:id` 등 파라미터 지원
- **쿼리 스트링 파싱**: URL 쿼리 파라미터 추출

#### 2.2 인증 가드
- **Auth Guard**: 인증 필요 페이지 접근 시 토큰 검사
- **Onboarding Guard**: 온보딩 미완료 시 온보딩 페이지로 리다이렉트
- **무한 리다이렉트 방지**: 조건 체크 로직

#### 2.3 지원 라우트
- `/login`, `/signup`: 로그인/회원가입
- `/`: 홈페이지 (의원/종목 목록)
- `/politician/:id`: 의원 프로필 페이지
- `/trade/:id`: 거래 상세 페이지
- `/stock/:id`: 종목 상세 페이지 (준비 중)
- `/onboarding`: 온보딩 페이지
- `/settings`: 설정 페이지
- `/subscription`: 구독 관리 페이지

---

### 3. 데이터 처리 시스템 (`data.js`)

#### 3.1 CSV 데이터 로드
- **CSV 파싱**: 수동 파싱 (쉼표, 따옴표 처리)
- **날짜 변환**: `MM/DD/YYYY` → `YYYY-MM-DD` 형식 변환
- **금액 범위 파싱**: `$1,000 - $15,000` 형식 → 중간값 계산

#### 3.2 거래 데이터 처리
- **거래 타입 변환**: `purchase` → `buy`, `sale` → `sell`, `exchange` → 제외
- **매수 선행 필터**: 각 티커의 첫 거래가 매수인 경우만 수익률 계산에 포함
- **거래 매칭**: FIFO 방식으로 매수-매도 쌍 매칭

#### 3.3 S&P 500 데이터 처리
- **실제 데이터 로드**: `sp500_history.json` 파일에서 일별 지수 로드
- **폴백 데이터**: 파일이 없을 경우 날짜별 연 10% 성장 곡선 생성 (확정 곡선, 새로고침해도 동일)
- **날짜별 지수 조회**: 특정 날짜의 S&P 500 종가 반환

#### 3.4 수익률 계산
- **거래 기반 수익률**: 매수-매도 쌍 기준 실현/미실현 수익률 계산
- **Net Worth 방법**: $10,000 초기 투자로 포트폴리오 시뮬레이션
- **S&P 500 비교**: 동일 기간 S&P 500 수익률과 비교

---

### 4. UI 컴포넌트 시스템 (`components.js`)

#### 4.1 페이지 컴포넌트
- **로그인 페이지**: 이메일/Google 로그인, 회원가입 탭 전환
- **홈페이지**: 의원/종목 탭 전환, 검색/필터/정렬 기능
- **의원 프로필 페이지**: 요약 정보, 수익률 그래프, 매매 내역 테이블
- **거래 상세 페이지**: 거래 정보, 주가 추이 그래프, 관련 거래 히스토리
- **온보딩 페이지**: 2단계 (의원 팔로우 → 관심 종목 선택)
- **설정 페이지**: 알림 설정, 구독 관리

#### 4.2 공통 컴포넌트
- **헤더**: 로고, 네비게이션, 사용자 메뉴
- **리스트 아이템**: 의원/종목 카드, 팔로우/관심종목 버튼
- **차트 컨테이너**: Canvas 기반 그래프 영역
- **토스트 알림**: 성공/에러/정보 메시지 표시

---

### 5. 메인 애플리케이션 로직 (`app.js`)

#### 5.1 초기화
- **데이터 로드**: CSV 파일 로드 및 파싱
- **라우트 등록**: 모든 페이지 라우트 등록
- **라우터 초기화**: 해시 변경 이벤트 리스너 등록

#### 5.2 페이지 렌더링
- **동적 렌더링**: 라우트 변경 시 해당 페이지 컴포넌트 렌더링
- **차트 그리기**: Canvas API를 사용한 수익률 그래프 그리기
- **데이터 바인딩**: 로드된 데이터를 UI에 바인딩

#### 5.3 이벤트 핸들러
- **검색/필터/정렬**: 실시간 리스트 필터링
- **팔로우/관심종목 토글**: LocalStorage에 저장
- **차트 타입 전환**: 거래일 기준 ↔ 공시일 기준 전환

---

### 6. 수익률 계산 로직 (상세)

#### 6.1 Net Worth 방법 포트폴리오 시뮬레이션

**기본 원칙**:
- 초기 현금: $10,000
- 매수: 보유 수량 증가, 현금 감소
- 매도: 보유 수량 감소, 매도 대금은 현금으로 전환 (재투자 없음)

**일별 가치 계산**:
```
의원 포트폴리오 가치_t = Σ(보유수량 × 당일가격) + 현금
S&P 500 가치_t = $10,000 × (지수_t / 지수_0)
```

**누적 수익률**:
```
누적 수익률_t = (가치_t / 가치_0 - 1) × 100 (%)
```

#### 6.2 가격 기준 전환
- **거래일 기준**: `price_trade_date` 사용 (거래일 가격)
- **공시일 기준**: `price_filing_date` 사용 (공시일 가격)

#### 6.3 매수 선행 필터
- 각 티커의 첫 거래가 매수인 경우만 수익률 계산에 포함
- 첫 거래가 매도인 경우 해당 티커 전체 제외

#### 6.4 S&P 500 비교
- 동일 시작일 기준으로 $10,000 투자 가정
- 같은 축, 0%에서 시작하는 누적 수익률로 비교

---

### 7. 차트 시각화

#### 7.1 수익률 비교 그래프 (`drawPerformanceChart`)
- **Y축**: 누적 수익률 (%)
- **X축**: 날짜
- **의원 포트폴리오**: 녹색 실선
- **S&P 500**: 회색 점선
- **0% 기준선**: 시작일 기준선 표시

#### 7.2 주가 추이 그래프 (`drawStockChart`)
- **Y축**: 주가 ($)
- **X축**: 날짜
- **거래일 마커**: 녹색 원
- **공시일 마커**: 주황색 원

---

### 8. 사용자 데이터 관리 (`UserData`)

#### 8.1 팔로우 관리
- **팔로우 목록**: LocalStorage에 의원 ID 배열 저장
- **무료 사용자 제한**: 최대 3명 팔로우 (유료 구독 시 무제한)

#### 8.2 관심 종목 관리
- **관심 종목 목록**: LocalStorage에 종목 ID 배열 저장
- **제한 없음**: 무료 사용자도 무제한 추가 가능

#### 8.3 설정 관리
- **이메일 알림**: ON/OFF 토글
- **뉴스레터**: ON/OFF 토글
- **구독 정보**: 플랜, 결제일 등 저장

---

### 9. Python 스크립트

#### 9.1 `fetch_sp500.py`
- **목적**: S&P 500 일별 지수 데이터 수집
- **데이터 소스**: yfinance (`^GSPC`)
- **출력**: `sp500_history.json` (날짜, 종가 배열)

#### 9.2 `networth_portfolio_comparison.py`
- **목적**: 의원 포트폴리오와 S&P 500 비교 그래프 생성
- **입력**: CSV 거래 데이터
- **출력**: PNG 그래프 파일
- **시각화**: matplotlib 사용

---

## 📊 데이터 흐름

### 데이터 로드 흐름
```
1. CSV 파일 로드 (kevin_hern_trades.csv)
   ↓
2. CSV 파싱 및 거래 데이터 추출
   ↓
3. S&P 500 데이터 로드 (sp500_history.json 또는 폴백 생성)
   ↓
4. 의원별 수익률 계산
   - 매수 선행 필터
   - Net Worth 방법 시뮬레이션
   - S&P 500 비교
   ↓
5. 전역 변수에 저장 (MOCK_POLITICIANS, MOCK_STOCKS, MOCK_TRADES)
   ↓
6. UI 렌더링
```

### 수익률 계산 흐름
```
1. 의원 거래 데이터 필터링
   ↓
2. 매수 선행 티커만 선택
   ↓
3. 날짜순 정렬
   ↓
4. 일별 포트폴리오 시뮬레이션
   - BUY: 보유 수량 증가, 현금 감소
   - SELL: 보유 수량 감소, 현금 증가
   ↓
5. 일별 가치 계산
   - 포트폴리오 가치 = Σ(보유수량 × 당일가격) + 현금
   - S&P 500 가치 = $10,000 × (지수_t / 지수_0)
   ↓
6. 누적 수익률 계산
   - (가치_t / 가치_0 - 1) × 100
   ↓
7. 그래프 렌더링
```

---

## 🔐 보안 및 제약사항

### 현재 구현 상태
- **클라이언트 사이드 인증**: JWT 토큰을 LocalStorage에 저장 (실제 환경에서는 서버 사이드 검증 필요)
- **비밀번호 해시**: 단순 해시 함수 사용 (실제 환경에서는 bcrypt/argon2 필요)
- **데이터 저장**: 모든 데이터가 클라이언트에 저장됨 (실제 환경에서는 서버 API 필요)

### 제한사항
- **무료 사용자**: 최대 3명의 의원만 팔로우 가능
- **데이터 실시간성**: CSV 기반 데이터로 실시간 업데이트 없음
- **주가 데이터**: 마지막 거래 종가 기준 (실시간 API 연동 필요)

---

## 📈 향후 개선 사항

### 기능 개선
1. **실시간 주가 API 연동**: yfinance 또는 Alpha Vantage API
2. **서버 사이드 인증**: 실제 JWT 토큰 검증 및 사용자 관리
3. **데이터베이스 연동**: 의원/거래 데이터를 DB에 저장
4. **배치 작업**: 매일 00:00에 수익률 데이터 갱신
5. **이메일 알림**: 실제 이메일 발송 기능
6. **뉴스레터**: 주간 요약 뉴스레터 자동 발송

### 성능 개선
1. **데이터 캐싱**: 자주 조회되는 데이터 캐싱
2. **무한 스크롤**: 대량 데이터 페이징 처리
3. **차트 최적화**: 대량 데이터 렌더링 성능 개선

### UX 개선
1. **로딩 상태**: 스켈레톤 UI 개선
2. **에러 처리**: 더 명확한 에러 메시지 및 복구 방법 제시
3. **반응형 디자인**: 모바일 최적화

---

## 📝 요구사항 문서 매핑

`requirements.md` 파일에 정의된 기능들이 다음과 같이 구현되어 있습니다:

| 요구사항 | 구현 상태 | 파일 위치 |
|---------|---------|----------|
| 로그인/회원가입 | ✅ 구현됨 | `auth.js`, `components.js` |
| 의원 목록/검색/필터 | ✅ 구현됨 | `app.js`, `components.js` |
| 의원 프로필 | ✅ 구현됨 | `app.js`, `components.js` |
| 수익률 그래프 | ✅ 구현됨 | `app.js` (drawPerformanceChart) |
| 매매 내역 | ✅ 구현됨 | `components.js` |
| 거래 상세 | ✅ 구현됨 | `app.js`, `components.js` |
| 팔로우 기능 | ✅ 구현됨 | `app.js`, `auth.js` (UserData) |
| 온보딩 | ✅ 구현됨 | `app.js`, `components.js` |
| 설정 페이지 | ✅ 구현됨 | `components.js` |
| 구독 관리 | ⚠️ UI만 구현 | `components.js` (결제 연동 필요) |
| 이메일 알림 | ⚠️ 설정만 구현 | `auth.js` (실제 발송 기능 필요) |
| 뉴스레터 | ⚠️ 설정만 구현 | `auth.js` (실제 발송 기능 필요) |

---

## 🎨 UI/UX 설계

### 디자인 시스템
- **색상**: 
  - Primary: 민주당 (파란색), 공화당 (빨간색)
  - Success: 녹색 (수익)
  - Danger: 빨간색 (손실)
  - Neutral: 회색 (S&P 500)
- **타이포그래피**: Inter 폰트 사용
- **아이콘**: Font Awesome 6.4.0

### 주요 화면 구성
1. **로그인 페이지**: 중앙 정렬 카드 레이아웃
2. **홈페이지**: 탭, 검색/필터 바, 리스트 컨테이너
3. **의원 프로필**: 헤더(아바타, 정보), 통계 카드, 차트, 거래 테이블
4. **거래 상세**: 헤더(종목 정보), 상세 정보 그리드, 차트, 관련 거래 히스토리

---

## 📚 참고 문서

- `수익률_계산_로직.md`: 수익률 계산 로직 상세 설명
- `requirements.md`: 기능 요구사항 명세

---

**작성일**: 2026-01-28  
**프로젝트 버전**: ver1
